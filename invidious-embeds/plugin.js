(function(exports){var b=Object.create,c=Object.defineProperty,d=Object.getOwnPropertyDescriptor,e=Object.getOwnPropertyNames,f=Object.getPrototypeOf,g=Object.prototype.hasOwnProperty,h=(M,N)=>()=>(N||M((N={exports:{}}).exports,N),N.exports),i=(M,N,O,P)=>{if(N&&typeof N==="object"||typeof N==="function"){for(var Q=e(N),R=0,S=Q.length,T;R<S;R++)if(T=Q[R],!g.call(M,T)&&T!==O)c(M,T,{get:((U)=>N[U]).bind(null,T),enumerable:!(P=d(N,T))||P.enumerable})}return M},j=(M,N,O)=>(O=M!=null?b(f(M)):{},i(N||!M||!M.__esModule?c(O,"default",{value:M,enumerable:!0}):O,M)),k=h((exports,N)=>{N.exports=shelter.solidWeb});async function l(){const M=await fetch("https://api.invidious.io/instances.json?pretty=0&sort_by=type,users"),N=await M.json(),O=N.map((R)=>R[1].uri);console.log("Testing Invidious instances...");let P=Infinity,Q=null;for(const R of O){if(!R.includes("https"))continue;const S=performance.now();try{await fetch(R,{mode:"no-cors"})}catch(V){}const T=performance.now(),U=T-S;console.log(R,U);if(U<P)P=U,Q=R}console.log("Fastest instance:",Q,P);return Q}var m=j(k(),1),n=j(k(),1),o=j(k(),1),p=j(k(),1),q=j(k(),1),r=j(k(),1),s=j(k(),1);const t=(0,m.template)("<iframe class=\"invidious-embed\" allow=\"fullscreen\"></iframe>",2),u=(0,m.template)("<div class=\"invidious-thumbnail invidious-embed\"><div class=\"invidious-wrapper\"><svg class=\"invidious-playbutton\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><path fill=\"white\" d=\"M9.25 3.35C7.87 2.45 6 3.38 6 4.96v14.08c0 1.58 1.87 2.5 3.25 1.61l10.85-7.04a1.9 1.9 0 0 0 0-3.22L9.25 3.35Z\" class=\"\"></path></svg></div></div>",8),{plugin:{store:v},observeDom:w,flux:{dispatcher:x,storesFlat:{SelectedChannelStore:y}},util:{reactFiberWalker:z,getFiber:A},ui:{Header:B,HeaderTags:C,TextBox:D,injectCss:E}}=shelter,F=["MESSAGE_CREATE","MESSAGE_UPDATE","UPDATE_CHANNEL_DIMENSIONS"];async function G(){const M=new Date().getDate();if(!v.instance||M%2===0)v.instance=await l();if(window["goofcord"]&&window.goofcord.getConfig("invidiousEmbeds")===!1)return;K(L,"invidious-embed-css");for(const N of F)x.subscribe(N,I)}function H(){for(const M of F)x.unsubscribe(M,I)}function I(M){if(!v.instance)return;if((M.type==="MESSAGE_CREATE"||M.type==="MESSAGE_UPDATE")&&M.message.channel_id!==y.getChannelId())return;const N=w("[id^=\"chat-messages-\"] article:not([data-invidivizer])",(O)=>{O.dataset.invidivizer="1";N();O.parentElement.querySelector(`iframe[src*="${v.instance}"]`)?.remove();O.parentElement.getElementsByClassName("invidious-thumbnail").item(0)?.remove();const P=z(A(O),"embed",!0)?.memoizedProps?.embed?.url;if(typeof P!=="string"||!P.startsWith("https://www.youtube.com"))return;O.style.display="none";const Q=P.replace("https://www.youtube.com/watch?v=",""),R=(()=>{const U=(0,s.getNextElement)(t);(0,r.effect)(()=>(0,q.setAttribute)(U,"src",`${v.instance}/embed/${Q}?autoplay=1&player_style=youtube&local=true`));return U})();function S(){O.insertAdjacentElement("afterend",R),T.style.display="none"}const T=(()=>{const U=(0,s.getNextElement)(u),V=U.firstChild,W=V.firstChild;W.$$click=S;(0,p.runHydrationEvents)();return U})();T.style.backgroundImage=`url(https://i.ytimg.com/vi/${Q}/hqdefault.jpg)`;O.insertAdjacentElement("afterend",T)});setTimeout(N,1e3)}const J=()=>[(0,o.createComponent)(B,{get tag(){return C.H3},children:"Invidious Instance"}),(0,o.createComponent)(D,{placeholder:"my.instance.com",get value(){return v.instance},onInput:(M)=>v.instance=M})];function K(M,N){const O=document.getElementById(N);if(!O){const P=document.createElement("style");P.id=N;P.textContent=M;document.head.appendChild(P)}else O.textContent=M}const L="\n    .invidious-embed {\n        border: 0; \n        width: 100%; \n        max-width: 500px; \n        aspect-ratio: 16/9; \n        border-radius: 4px\n    }\n    \n    .invidious-thumbnail {\n        display: flex;\n        align-content: center;\n        flex-wrap: wrap;\n        justify-content: center;\n        background-position: center;\n        background-size: cover;\n    }\n    \n    .invidious-wrapper {\n        box-sizing: border-box;\n        display: flex;\n        padding: 12px;\n        height: 48px;\n        border-radius: 24px;\n        background-color: hsl(0 calc( 1 * 0%) 0% /.6);\n    }\n    \n    .invidious-playbutton {\n        cursor: pointer;\n        transition: opacity .25s;\n        opacity: .6;\n    }\n    \n    .invidious-playbutton:hover {\n        opacity: 1;\n    }\n";(0,n.delegateEvents)(["click"]);exports.onLoad=G;exports.onUnload=H;exports.settings=J;return exports})({});