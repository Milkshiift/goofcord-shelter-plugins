(()=>{var o=Object.defineProperty;var f=Object.getOwnPropertyDescriptor;var g=Object.getOwnPropertyNames;var m=Object.prototype.hasOwnProperty;var M=(n,e)=>{for(var t in e)o(n,t,{get:e[t],enumerable:!0})},E=(n,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of g(e))!m.call(n,a)&&a!==t&&o(n,a,{get:()=>e[a],enumerable:!(i=f(e,a))||i.enumerable});return n};var Q=n=>E(o({},"__esModule",{value:!0}),n);var U={};M(U,{onLoad:()=>y,onUnload:()=>C});var{util:{log:S},flux:{stores:{UserStore:x,MediaEngineStore:I},dispatcher:u}}=shelter,_=[480,720,1080,1440],b=[5,15,30,60],r=720,d=1280,s=30;function v(n,e){r=c(n,_),d=Math.round(r*(screen.width/screen.height)),s=c(e,b)}async function h(){let n=[...I.getMediaEngine().connections],e=x.getCurrentUser().id,t=n.find(i=>i.streamUserId===e);t&&(t.videoStreamParameters[0].maxFrameRate=s,t.videoStreamParameters[0].maxResolution.height=r,t.videoStreamParameters[0].maxResolution.width=d,t.videoQualityManager.goliveMaxQuality.bitrateMin=5e5,t.videoQualityManager.goliveMaxQuality.bitrateMax=8e6,t.videoQualityManager.goliveMaxQuality.bitrateTarget=6e5,S(`Patched current user stream with resolution: ${r} and fps: ${s}`))}function y(){u.subscribe("MEDIA_ENGINE_VIDEO_SOURCE_QUALITY_CHANGED",h)}function C(){u.unsubscribe("MEDIA_ENGINE_VIDEO_SOURCE_QUALITY_CHANGED",h)}function c(n,e){let t=e[0],i=Math.abs(n-t);for(let a=1;a<e.length;a++){let l=Math.abs(n-e[a]);l<i&&(t=e[a],i=l)}return t}window.ScreenshareQuality={};window.ScreenshareQuality.patchScreenshareQuality=v;return Q(U);})();
